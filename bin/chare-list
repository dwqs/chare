#!/usr/bin/env node

let chalk = require('chalk');
let ora = require('ora');
let axios = require('axios');
let program = require('commander');

let log = require('../src/log');

/**
 * Help.
 */

program.on('--help', function () {
    log.tips('  Examples:');
    log.tips();
    log.tips(chalk.gray('    # list all available official templates from github.com/waka-templates'));
    log.tips('    $ chare list');
    log.tips();
});

if(process.argv[2]){
    program.help();
}

/**
 * Padding
 */
log.tips();

let spinner = ora({
    text: "fetching templates list...",
    color:"blue"
}).start();

process.on('exit', () => log.tips());

/**
 * List repos.
 */

axios({
    url:  'https://api.github.com/users/waka-templates/repos',
    method: 'get',
    headers: {
        'User-Agent': 'chare-cli'
    },
    auth:{
        "username":'dwqs',
        "password":"3b89a5a4337405a5bfe8d3512c9c30ea9ca1c210"
    }
}).then((res) => {
    if (Array.isArray(res.data)) {
        spinner.text = chalk.green('Available official templates:');
        spinner.succeed();

        log.tips();
        res.data.forEach(function (repo) {
            log.tips(
                '  ' + chalk.yellow('*') +
                '  ' + chalk.blue(repo.name) +
                ' - ' + repo.description);
        });
    } else {
        spinner.text = chalk.white('chare cli:fetching templates list failed, error message as follows:');
        spinner.fail();

        log.tips();
        log.error(`     ${res.statusText}`);
    }
}).catch((err) => {
    let res = err.response;
    if(err){
        spinner.text = chalk.white('chare cli:fetching templates list failed, error message as follows:');
        spinner.fail();
        log.tips();
        log.error(`     ${res.statusText}: ${res.data.message}`);
    }
});


